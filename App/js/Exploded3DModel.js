// model
var data = JSON.stringify( {
  "asset": {
    "version": "2.0",
    "generator": "THREE.GLTFExporter"
  },
  "scenes": [
    {
      "nodes": [
        6
      ]
    }
  ],
  "scene": 0,
  "nodes": [
    {
      "matrix": [
        1,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0.0249728858,
        0,
        1
      ],
      "name": "Box001",
      "extras": {
        "name": "Box001"
      },
      "mesh": 0
    },
    {
      "matrix": [
        0.5,
        0,
        -0.8660254480000001,
        0,
        0,
        1,
        0,
        0,
        0.8660254480000001,
        0,
        0.5,
        0,
        0,
        0.0249728858,
        0,
        1
      ],
      "name": "Box002",
      "extras": {
        "name": "Box002"
      },
      "mesh": 0
    },
    {
      "matrix": [
        -0.5000001531672016,
        0,
        -0.8660253960384732,
        0,
        0,
        1,
        0,
        0,
        0.8660253960384732,
        0,
        -0.5000001531672016,
        0,
        0,
        0.0249728858,
        0,
        1
      ],
      "name": "Box003",
      "extras": {
        "name": "Box003"
      },
      "mesh": 0
    },
    {
      "matrix": [
        -1.0000000000000007,
        0,
        8.742278e-8,
        0,
        0,
        1,
        0,
        0,
        -8.742278e-8,
        0,
        -1.0000000000000007,
        0,
        0,
        0.0249728858,
        0,
        1
      ],
      "name": "Box004",
      "extras": {
        "name": "Box004"
      },
      "mesh": 0
    },
    {
      "matrix": [
        -0.4999999868903192,
        0,
        0.8660255732050798,
        0,
        0,
        1,
        0,
        0,
        -0.8660255732050798,
        0,
        -0.4999999868903192,
        0,
        0,
        0.0249728858,
        0,
        1
      ],
      "name": "Box005",
      "extras": {
        "name": "Box005"
      },
      "mesh": 0
    },
    {
      "matrix": [
        0.49999979999998023,
        0,
        0.8660255732050799,
        0,
        0,
        1,
        0,
        0,
        -0.8660255732050799,
        0,
        0.49999979999998023,
        0,
        0,
        0.0249728858,
        0,
        1
      ],
      "name": "Box006",
      "extras": {
        "name": "Box006"
      },
      "mesh": 0
    },
    {
      "matrix": [
        0.24573517674007994,
        0.2382001994395046,
        0.9396142229125217,
        0,
        -0.9693370017246437,
        0.060385777087478165,
        0.2382001994395046,
        0,
        5.551115123125783e-17,
        -0.9693370017246437,
        0.24573517674007994,
        0,
        -2.9802322387695312e-8,
        -0.02497288759341143,
        0,
        1
      ],
      "name": "Star-1gltf",
      "extras": {
        "name": "Star-1.gltf"
      },
      "children": [
        0,
        1,
        2,
        3,
        4,
        5
      ]
    }
  ],
  "bufferViews": [
    {
      "buffer": 0,
      "byteOffset": 0,
      "byteLength": 288,
      "target": 34962,
      "byteStride": 12
    },
    {
      "buffer": 0,
      "byteOffset": 288,
      "byteLength": 288,
      "target": 34962,
      "byteStride": 12
    },
    {
      "buffer": 0,
      "byteOffset": 576,
      "byteLength": 192,
      "target": 34962,
      "byteStride": 8
    },
    {
      "buffer": 0,
      "byteOffset": 768,
      "byteLength": 72,
      "target": 34963
    }
  ],
  "buffers": [
    {
      "byteLength": 840,
      "uri": "data:application/octet-stream;base64,wdh0vfCTzLzrYs+9PCYkvPCTzLygPjW/PCYkPPCTzLygPjW/wdh0PfCTzLzrYs+9wdh0vfCTzDzrYs+9wdh0PfCTzDzrYs+9PCYkPPCTzDygPjW/PCYkvPCTzDygPjW/wdh0vfCTzLzrYs+9wdh0PfCTzLzrYs+9wdh0PfCTzDzrYs+9wdh0vfCTzDzrYs+9wdh0PfCTzLzrYs+9PCYkPPCTzLygPjW/PCYkPPCTzDygPjW/wdh0PfCTzDzrYs+9PCYkPPCTzLygPjW/PCYkvPCTzLygPjW/PCYkvPCTzDygPjW/PCYkPPCTzDygPjW/PCYkvPCTzLygPjW/wdh0vfCTzLzrYs+9wdh0vfCTzDzrYs+9PCYkvPCTzDygPjW/AAAAAAAAgL8AAACAAAAAAAAAgL8AAACAAAAAAAAAgL8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/tyR/PwAAAACcZae9tyR/PwAAAACcZae9tyR/PwAAAACcZae9tyR/PwAAAACcZae9AAAAAAAAAAAAAIC/AAAAAAAAAAAAAIC/AAAAAAAAAAAAAIC/AAAAAAAAAAAAAIC/tyR/vwAAAACcZae9tyR/vwAAAACcZae9tyR/vwAAAACcZae9tyR/vwAAAACcZae9AACAPwAAgD8AAIA/AAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAAAAAAAAAAAAAAAAAAAAAAIA/AACAPwAAgD8AAIA/AAAAAAAAAAAAAAAAAAAAAAAAgD8AAIA/AACAPwAAgD8AAAAAAAAAAAAAAAAAAAAAAACAPwAAgD8AAIA/AACAPwAAAAAAAAAAAAAAAAAAAAAAAIA/AACAPwAAgD8AAIA/AAAAAAAAAAAAAAAAAAABAAIAAgADAAAABAAFAAYABgAHAAQACAAJAAoACgALAAgADAANAA4ADgAPAAwAEAARABIAEgATABAAFAAVABYAFgAXABQA"
    }
  ],
  "accessors": [
    {
      "bufferView": 0,
      "componentType": 5126,
      "count": 24,
      "max": [
        0.05977702513337135,
        0.024972885847091675,
        -0.1012628898024559
      ],
      "min": [
        -0.05977702513337135,
        -0.024972885847091675,
        -0.7079868316650391
      ],
      "type": "VEC3"
    },
    {
      "bufferView": 1,
      "componentType": 5126,
      "count": 24,
      "max": [
        0.9966539740562439,
        1,
        1
      ],
      "min": [
        -0.9966539740562439,
        -1,
        -1
      ],
      "type": "VEC3"
    },
    {
      "bufferView": 2,
      "componentType": 5126,
      "count": 24,
      "max": [
        1,
        1
      ],
      "min": [
        0,
        0
      ],
      "type": "VEC2"
    },
    {
      "bufferView": 3,
      "componentType": 5123,
      "count": 36,
      "max": [
        23
      ],
      "min": [
        0
      ],
      "type": "SCALAR"
    }
  ],
  "materials": [
    {
      "pbrMetallicRoughness": {
        "metallicFactor": 1,
        "roughnessFactor": 1
      },
      "emissiveFactor": [
        0.9098039215686274,
        0.06666666666666667,
        0.06666666666666667
      ],
      "name": "entity_1"
    }
  ],
  "meshes": [
    {
      "primitives": [
        {
          "mode": 4,
          "attributes": {
            "POSITION": 0,
            "NORMAL": 1,
            "TEXCOORD_0": 2
          },
          "indices": 3,
          "material": 0
        }
      ]
    }
  ]
});

//
function createElementFromHTML(htmlString) {
  var div = document.createElement('div');
  div.innerHTML = htmlString.trim();

  // Change this to div.childNodes to support multiple top-level nodes
  return div.firstChild; 
}



// var sceneEl = document.createElement("a-scene");
var sceneEl = createElementFromHTML(`    <a-scene
      arjs
      embedded
      renderer="logarithmicDepthBuffer: true;"
      vr-mode-ui="enabled: false"
      gesture-detector
      id="scene"
      cursor="rayOrigin: mouse"
    ></a-scene>`);

sceneEl.innerHTML=` 
    
     

      <a-camera id="camera">
        <a-marker
          type="pattern"
          url="../Assets/A2.patt"
          id="markerA"
        ></a-marker>
        <a-entity
          
          cursor="fuse: true; fuseTimeout: 0"
          position="0 0 -1"
          geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.025"
          material="color: white; shader: flat;opacity:1"   visible="true"      
        ></a-entity>
        
        <a-entity
          position="0 0 -5"
          scale="1 1 1"
          gesture-handler
          id="vatlook"
        >
          <a-entity id="bowser-model1" vat-model visible="true">
           
       <a-sphere  position="0 0 0" btn1 radius="0.1"  color="#FFF000" shadow></a-sphere>  
          </a-entity>

        </a-entity>
    </a-camera>
    `;

 document.body.appendChild(sceneEl);
AFRAME.registerComponent("vat-model",{
 init: function () {
   //three js loader code + attaching it to the entity's object3D
  var loader = new THREE.GLTFLoader();
		loader.parse( data, '', ( gltf ) => {		
			gltf.scene.traverse( ( child ) => {			
				if ( child.isMesh ) {				
					// child.geometry.center();				
				}			
			} );		
			this.el.object3D.add( gltf.scene );		
		} );
     }
});




  AFRAME.registerComponent("btn1", {
       init: function(){
                let el = this.el;
                let self = this;
   var tree3D;
   let modelElement =document.querySelector("#bowser-model1");
         modelElement.addEventListener('model-loaded', (e) => {
  tree3D = modelElement.getObject3D('mesh');
 alert("hi")
  console.log(tree3D)
})  
         
                el.addEventListener("click", e =>{
                  alert("hi")
                  
                    // let tree3D = el.getObject3D('mesh');

                    if (!tree3D){return;}    
                  console.log('tree3D', tree3D);
                    tree3D.traverse(function(node){
                        if (node.isMesh){   
                          console.log(node);
                          if(node.name=="Box001"){
                            self.tree = node;                            
                          }
                        }
                    });
              });
            },
          tick: function(){
            if(this.tree){
              this.tree.rotateY(0.01);
              this.tree.position.x=-0.5;
            }
          }
      });




		






